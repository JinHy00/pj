<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.pj.mapper.OrderMapper">

    <!-- 특정 회원의 주문 목록 조회 -->
    <select id="getOrderListByUserId" parameterType="String" resultType="com.example.pj.dto.OrderDTO">
        SELECT o.orderCode, o.productCode, o.userid, o.couponid, o.recipient, o.rec_phonenum AS recPhoneNum,
               o.zipCode, o.mainAddress, o.detailAddress, o.usePoint, o.orderState, o.orderDate,
               p.productName, p.price, p.mainImage
        FROM orders o
        JOIN product p ON o.productCode = p.productCode
        WHERE o.userid = #{userId}
        ORDER BY o.orderDate DESC
    </select>

    <!-- 주문 상세 조회 -->
    <select id="getOrderDetail" parameterType="int" resultType="com.example.pj.dto.OrderDTO">
        SELECT o.orderCode, o.productCode, o.userid, o.couponid, o.recipient, o.rec_phonenum AS recPhoneNum,
               o.zipCode, o.mainAddress, o.detailAddress, o.usePoint, o.orderState, o.orderDate,
               p.productName, p.price, p.mainImage
        FROM orders o
        JOIN product p ON o.productCode = p.productCode
        WHERE o.orderCode = #{orderCode}
    </select>

    <!-- 주문 생성 -->
    <insert id="createOrder" parameterType="com.example.pj.dto.OrderDTO">
        INSERT INTO orders (productCode, userid, couponid, recipient, rec_phonenum, zipCode, 
                            mainAddress, detailAddress, usePoint, orderState, orderDate)
        VALUES (#{productCode}, #{userid}, #{couponid}, #{recipient}, #{recPhoneNum}, #{zipCode}, 
                #{mainAddress}, #{detailAddress}, #{usePoint}, #{orderState}, NOW())
    </insert>

    <!-- 주문 상태 변경 -->
    <update id="updateOrderState" parameterType="map">
        UPDATE orders
        SET orderState = #{orderState}
        WHERE orderCode = #{orderCode}
    </update>

</mapper>
